import{a as W}from"./chunk-IJUAJ5I6.js";import{a as X,b as Y,c as z,d as J,e as ee,f as te,g as ie,i as ne,j as re,k as se,l as ae,m as le,n as oe}from"./chunk-BEV72FF3.js";import{j as Q}from"./chunk-NXZILXPK.js";import{$ as x,Fa as q,H as K,L as b,M as m,Q as y,W as M,a as _,aa as N,ba as R,ca as F,d as A,ia as k,ka as j,o as P,pa as E,qa as G,r as B,ra as Z,ua as $,va as I,w as U,y as L}from"./chunk-47N7F2CL.js";var g=function(o){return o[o.Financial=0]="Financial",o[o.Natural=1]="Natural",o}(g||{}),me=new B("ngx-currency.config"),D=class{constructor(t){this._htmlInputElement=t,this._storedRawValue=null}setCursorAt(t){this._htmlInputElement.focus(),this._htmlInputElement.setSelectionRange(t,t)}updateValueAndCursor(t,e,n){this.rawValue=t;let i=t.length;n=n-(e-i),this.setCursorAt(n)}get canInputMoreNumbers(){let e=!((this.rawValue?.replace(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g,"")??"").length>=this._htmlInputElement.maxLength&&this._htmlInputElement.maxLength>=0),n=this.inputSelection.selectionStart,i=this.inputSelection.selectionEnd,r=!!(n!=i&&this._htmlInputElement.value.substring(n,i).match(/[^0-9\u0660-\u0669\u06F0-\u06F9]/)),s=this._htmlInputElement.value.substring(0,1)=="0";return e||r||s}get inputSelection(){return{selectionStart:this._htmlInputElement.selectionStart??0,selectionEnd:this._htmlInputElement.selectionEnd??0}}get rawValue(){return this._htmlInputElement&&this._htmlInputElement.value}set rawValue(t){this._storedRawValue=t,this._htmlInputElement&&(this._htmlInputElement.value=t??"")}get storedRawValue(){return this._storedRawValue||""}},H=class{constructor(t,e){this._options=e,this._singleDigitRegex=new RegExp(/^[0-9\u0660-\u0669\u06F0-\u06F9]$/),this._onlyNumbersRegex=new RegExp(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g),this._perArNumber=new Map([["\u06F0","0"],["\u06F1","1"],["\u06F2","2"],["\u06F3","3"],["\u06F4","4"],["\u06F5","5"],["\u06F6","6"],["\u06F7","7"],["\u06F8","8"],["\u06F9","9"],["\u0660","0"],["\u0661","1"],["\u0662","2"],["\u0663","3"],["\u0664","4"],["\u0665","5"],["\u0666","6"],["\u0667","7"],["\u0668","8"],["\u0669","9"]]),this.inputManager=new D(t)}addNumber(t){let{decimal:e,precision:n,inputMode:i}=this._options,r=String.fromCharCode(t),s=r===this._options.decimal;if(this.rawValue){let a=this.inputSelection.selectionStart,l=this.inputSelection.selectionEnd,d=this.rawValue.substring(0,a),u=this.rawValue.substring(l,this.rawValue.length),f=d.indexOf(e)!==-1;i===g.Natural&&f&&a===l&&(u=u.substring(1));let h=d+r+u,p=a+1;if((s||r===this._options.thousands)&&r===u[0])p++;else if(!this._singleDigitRegex.test(r))return;this.rawValue=h,this.updateFieldValue(p)}else{this.rawValue=this.applyMask(!1,r);let a;i===g.Natural&&n>0&&(a=this.rawValue.indexOf(e),s&&a++),this.updateFieldValue(a)}}applyMask(t,e,n=!1){let{allowNegative:i,decimal:r,precision:s,prefix:a,suffix:l,thousands:d,min:u,inputMode:f}=this._options,{max:h}=this._options;e=t?new Number(e).toFixed(s):e;let p=e.replace(this._onlyNumbersRegex,"");if(!p&&e!==r)return"";f===g.Natural&&!t&&!n&&(e=this.padOrTrimPrecision(e),p=e.replace(this._onlyNumbersRegex,""));let c=p.slice(0,p.length-s).replace(/^\u0660*/g,"").replace(/^\u06F0*/g,"").replace(/^0*/g,"");c==""&&(c="0");let S=parseInt(c);c=c.replace(/\B(?=([0-9\u0660-\u0669\u06F0-\u06F9]{3})+(?![0-9\u0660-\u0669\u06F0-\u06F9]))/g,d),d&&c.startsWith(d)&&(c=c.substring(1));let C=c,v=p.slice(p.length-s),V=parseInt(v)||0,T=e.indexOf("-")>-1;h=h==null||u===null||u===void 0?h:Math.max(h,u);let pe=Number("1".padEnd(s+1,"0")),w=S+V/pe;return w=T?-w:w,h!=null&&w>h?this.applyMask(!0,h+""):u!=null&&w<u?this.applyMask(!0,u+""):(s>0&&(C=="0"&&v.length<s?C+=r+"0".repeat(s-1)+v:C+=r+v),(T&&i?"-":"")+a+C+l)}padOrTrimPrecision(t){let{decimal:e,precision:n}=this._options,i=t.lastIndexOf(e);i===-1&&(i=t.length,t+=e);let r=t.substring(i).replace(this._onlyNumbersRegex,""),s=r.length;if(s<n)for(let a=s;a<n;a++)r+="0";else s>n&&(r=r.substring(0,r.length+n-s));return t.substring(0,i)+e+r}clearMask(t){if(this.isNullable()&&t==="")return null;let e=(t||"0").replace(this._options.prefix,"").replace(this._options.suffix,"");return this._options.thousands&&(e=e.replace(new RegExp("\\"+this._options.thousands,"g"),"")),this._options.decimal&&(e=e.replace(this._options.decimal,".")),this._perArNumber.forEach((n,i)=>{let r=new RegExp(i,"g");e=e.replace(r,n)}),parseFloat(e)}changeToNegative(){this._options.allowNegative&&this.rawValue?.charAt(0)!="-"&&(this.rawValue=this.applyMask(!1,"-"+(this.rawValue?this.rawValue:"0")))}changeToPositive(){this.rawValue=this.applyMask(!1,this.rawValue?.replace("-","")??"")}removeNumber(t){let{decimal:e,thousands:n,prefix:i,suffix:r,inputMode:s}=this._options;if(this.isNullable()&&this.value==0){this.rawValue=null;return}let a=this.inputSelection.selectionEnd,l=this.inputSelection.selectionStart,d=(this.rawValue?.length??0)-r.length;if(a=Math.min(d,Math.max(a,i.length)),l=Math.min(d,Math.max(l,i.length)),l===a&&this.inputSelection.selectionStart!==this.inputSelection.selectionEnd){this.updateFieldValue(l);return}let u=this.rawValue?.indexOf(e)??-1;u===-1&&(u=this.rawValue?.length??0);let f=0,h="",p=u<a,c=u+1===a;if(a===l){if(t==8){if(l<=i.length)return;l--,this.rawValue?.substring(l,l+1).match(/\d/)||l--,s===g.Natural&&p&&(f=-1,c&&(this.value??0)<10&&(this.value??0)>-10&&(h+="0"))}else if(t==46||t==63272){if(l===d)return;a++,this.rawValue?.substring(l,l+1).match(/\d/)||(l++,a++)}}if(s===g.Natural&&l>u){let v=a-l;for(let V=0;V<v;V++)h+="0"}let S=(this.rawValue?.length??0)-a;this.rawValue=this.rawValue?.substring(0,l)+h+this.rawValue?.substring(a),this.rawValue.substring(i.length,i.length+1)===n&&(this.rawValue=this.rawValue.substring(0,i.length)+this.rawValue.substring(i.length+1),S=Math.min(S,this.rawValue.length-i.length)),this.updateFieldValue(this.rawValue.length-S+f,!0)}updateFieldValue(t,e=!1){let n=this.applyMask(!1,this.rawValue??"",e);t??=this.rawValue?.length??0,t=Math.max(this._options.prefix.length,Math.min(t,(this.rawValue?.length??0)-this._options.suffix.length)),this.inputManager.updateValueAndCursor(n,this.rawValue?.length??0,t)}updateOptions(t){let e=this.value;this._options=t,this.value=e}prefixLength(){return this._options.prefix.length}suffixLength(){return this._options.suffix.length}isNullable(){return this._options.nullable}get canInputMoreNumbers(){return this.inputManager.canInputMoreNumbers}get inputSelection(){return this.inputManager.inputSelection}get rawValue(){return this.inputManager.rawValue}set rawValue(t){this.inputManager.rawValue=t}get storedRawValue(){return this.inputManager.storedRawValue}get value(){return this.clearMask(this.rawValue)}set value(t){this.rawValue=this.applyMask(!0,""+t)}_isNullOrUndefined(t){return t==null}},O=class{constructor(t,e){this.inputService=new H(t,e)}handleCut(){setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},0)}handleInput(){let t=this.inputService.rawValue??"",e=this.inputService.inputSelection.selectionStart,n=t.charCodeAt(e-1),i=t.length,r=this.inputService.storedRawValue.length;if(Math.abs(i-r)!=1){this.inputService.updateFieldValue(e),this.onModelChange(this.inputService.value);return}this.inputService.rawValue=this.inputService.storedRawValue,i<r&&this.timer(()=>{this.inputService.updateFieldValue(e+1),this.inputService.removeNumber(8),this.onModelChange(this.inputService.value)},0),i>r&&(this.inputService.updateFieldValue(e-1),this._handleKeypressImpl(n))}handleKeydown(t){let e=t.which||t.charCode||t.keyCode;(e==8||e==46||e==63272)&&(t.preventDefault(),this.inputService.inputSelection.selectionStart<=this.inputService.prefixLength()&&this.inputService.inputSelection.selectionEnd>=(this.inputService.rawValue?.length??0)-this.inputService.suffixLength()?this.clearValue():(this.inputService.removeNumber(e),this.onModelChange(this.inputService.value)))}clearValue(){this.setValue(this.inputService.isNullable()?null:0),this.onModelChange(this.inputService.value)}handleKeypress(t){let e=t.which||t.charCode||t.keyCode;t.preventDefault(),!(e===97&&t.ctrlKey)&&this._handleKeypressImpl(e)}_handleKeypressImpl(t){switch(t){case void 0:case 9:case 13:return;case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:this.inputService.canInputMoreNumbers&&(Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==(this.inputService.rawValue?.length??0)&&this.setValue(null),this.inputService.addNumber(t));break}this.onModelChange(this.inputService.value)}handlePaste(){setTimeout(()=>{this.inputService.updateFieldValue(),this.setValue(this.inputService.value),this.onModelChange(this.inputService.value)},1)}updateOptions(t){this.inputService.updateOptions(t)}getOnModelChange(){return this.onModelChange}setOnModelChange(t){this.onModelChange=t}getOnModelTouched(){return this.onModelTouched}setOnModelTouched(t){this.onModelTouched=t}setValue(t){this.inputService.value=t}timer(t,e){setTimeout(t,e)}},ue=(()=>{class o{set currencyMask(e){typeof e!="string"&&(this._options=e)}set options(e){this._options=e}constructor(e,n,i){this._elementRef=i,this._options={},this._optionsTemplate=_({align:"right",allowNegative:!0,allowZero:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:",",nullable:!1,inputMode:g.Financial},e),this._keyValueDiffer=n.find({}).create()}ngOnInit(){this._inputHandler=new O(this._elementRef.nativeElement,_(_({},this._optionsTemplate),this._options))}ngAfterViewInit(){this._elementRef.nativeElement.style.textAlign=this._options?.align??this._optionsTemplate.align}ngDoCheck(){this._keyValueDiffer.diff(this._options)&&(this._elementRef.nativeElement.style.textAlign=this._options?.align??this._optionsTemplate.align,this._inputHandler.updateOptions(_(_({},this._optionsTemplate),this._options)))}handleBlur(e){this._inputHandler.getOnModelTouched().apply(e)}handleCut(){this.isChromeAndroid()||!this.isReadOnly()&&this._inputHandler.handleCut()}handleInput(){this.isChromeAndroid()&&!this.isReadOnly()&&this._inputHandler.handleInput()}handleKeydown(e){this.isChromeAndroid()||!this.isReadOnly()&&this._inputHandler.handleKeydown(e)}handleKeypress(e){this.isChromeAndroid()||!this.isReadOnly()&&this._inputHandler.handleKeypress(e)}handlePaste(){this.isChromeAndroid()||!this.isReadOnly()&&this._inputHandler.handlePaste()}handleDrop(e){this.isChromeAndroid()||e.preventDefault()}isChromeAndroid(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)}isReadOnly(){return this._elementRef.nativeElement.hasAttribute("readonly")}registerOnChange(e){this._inputHandler.setOnModelChange(e)}registerOnTouched(e){this._inputHandler.setOnModelTouched(e)}setDisabledState(e){this._elementRef.nativeElement.disabled=e}writeValue(e){this._inputHandler.setValue(e)}static{this.\u0275fac=function(n){return new(n||o)(m(me,8),m($),m(K))}}static{this.\u0275dir=L({type:o,selectors:[["input","currencyMask",""]],hostBindings:function(n,i){n&1&&F("blur",function(s){return i.handleBlur(s)})("cut",function(){return i.handleCut()})("input",function(){return i.handleInput()})("keydown",function(s){return i.handleKeydown(s)})("keypress",function(s){return i.handleKeypress(s)})("paste",function(){return i.handlePaste()})("drop",function(s){return i.handleDrop(s)})},inputs:{currencyMask:"currencyMask",options:"options"},standalone:!0,features:[E([{provide:X,useExisting:P(()=>o),multi:!0}])]})}}return o})();var he=o=>Intl.NumberFormat("en",{style:"currency",currency:o}).formatToParts().find(e=>e.type==="currency").value;var ge=()=>["/lookup"],ce=class o{constructor(t,e,n){this.sendService=t;this.userService=e;this.router=n;let i=this.sendService.getTargetUser()();if(this.user=this.userService.user,!i){this.router.navigate(["/lookup"]),this.targetUser=y(null),this.currencyCode=y(null),this.currencyMaskConfig=y(null);return}this.targetUser=y(i),this.currencyCode=I(()=>this.targetUser().fiat_wallet_currency),this.currencyMaskConfig=I(()=>{let r=this.currencyCode();return{allowNegative:!1,allowZero:!1,decimal:".",precision:2,prefix:`${he(r)} `,thousands:",",nullable:!1}})}loading=y(!1);amountControl=new ee(0,[z.required]);currencyCode;currencyMaskConfig;targetUser;user;next(){return A(this,null,function*(){if(!this.amountControl.valid||!this.amountControl.value){this.amountControl.markAsTouched();return}this.loading.set(!0);try{let t=yield this.sendService.generateQuote(this.amountControl.value,this.user().fiat_wallet_currency,this.targetUser().fiat_wallet_currency);this.sendService.setQuote(t),this.sendService.setAmount(this.amountControl.value),this.router.navigate(["/confirm"])}catch{}finally{this.loading.set(!1)}})}static \u0275fac=function(e){return new(e||o)(m(oe),m(W),m(q))};static \u0275cmp=U({type:o,selectors:[["app-send"]],standalone:!0,features:[E([]),G],decls:8,vars:6,consts:[["title","How much do you want to send?",3,"backButtonUrl"],[1,"mb-4"],["hlmLabel",""],["hlmInput","","type","tel","placeholder","Amount",1,"w-80",3,"formControl","currencyMask"],[3,"clicked","loading"]],template:function(e,n){e&1&&(R(0,"app-header",0),x(1,"hlm-form-field",1)(2,"label",2),k(3," Amount "),R(4,"input",3),N(),x(5,"hlm-hint"),k(6),N()(),x(7,"app-submit-button",4),F("clicked",function(){return n.next()}),N()),e&2&&(M("backButtonUrl",Z(5,ge)),b(4),M("formControl",n.amountControl)("currencyMask",n.currencyMaskConfig()),b(2),j("The amount of ",n.currencyCode()," to send."),b(),M("loading",n.loading()))},dependencies:[se,ne,re,ae,ie,Y,J,te,ue,Q,le]})};export{ce as SendComponent};
